<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche de personnage</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main class="fiche-page" aria-labelledby="fichePageTitle">
        <header class="page-header">
            <a href="index.html" class="magic-back-link" title="Retour √† l'accueil">‚Üê Retour</a>
            <div class="page-header-main">
                <div class="page-title-block">
                    <h1 class="page-title" id="fichePageTitle">Fiche de personnage</h1>
                    <p class="page-subtitle">Identit√©, appartenances, magies et histoire du personnage.</p>
                </div>
                <div class="character-summary" aria-label="R√©sum√© du personnage">
                    <div class="character-avatar">
                        <!-- Avatar placeholder, remplac√© plus tard par une vraie image -->
                        <div class="character-avatar-circle">‚òÜ</div>
                    </div>
                    <div class="character-summary-text">
                        <span class="character-name">Nom du personnage</span>
                        <span class="character-tagline">Classe / R√¥le / Surnom</span>
                    </div>
                </div>
            </div>
        </header>

        <section class="fiche-container">
            <!-- Navigation (onglets) -->
            <nav class="fiche-sidebar" aria-label="Sections de la fiche">
                <button type="button" class="tab-button active" data-tab="identite">Identit√©</button>
                <button type="button" class="tab-button" data-tab="appartenance">Appartenance</button>
                <button type="button" class="tab-button" data-tab="combat">Combat</button>
                <button type="button" class="tab-button" data-tab="alice">Alice</button>
                <button type="button" class="tab-button" data-tab="sorcellerie">Sorcellerie</button>
                <button type="button" class="tab-button" data-tab="eater">Eater</button>
                <button type="button" class="tab-button" data-tab="religion">Religion</button>
                <button type="button" class="tab-button" data-tab="mental">Mental</button>
                <button type="button" class="tab-button" data-tab="physique">Physique</button>
                <button type="button" class="tab-button" data-tab="background">Background</button>
            </nav>

            <!-- Contenu -->
            <section class="fiche-content" aria-live="polite">
                <form class="fiche-form">
                    <!-- Identit√© -->
                    <section id="tab-identite" class="tab-panel active" aria-label="Identit√©">
                        <h2 class="section-title">Identit√©</h2>

                        <div class="field-group">
                            <label class="field-label" for="identiteNomPrenom">Nom &amp; pr√©nom</label>
                            <input
                                id="identiteNomPrenom"
                                class="field-input"
                                type="text"
                                placeholder="Nom complet, titres √©ventuels et patronymes (la noblesse peut avoir un nom long)."
                            >
                        </div>

                        <div class="field-group field-group--inline">
                            <div class="field-group">
                                <label class="field-label" for="identiteAge">√Çge</label>
                                <input id="identiteAge" class="field-input" type="text" placeholder="Ex : 17 ans">
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="identiteSexe">Sexe</label>
                                <input id="identiteSexe" class="field-input" type="text" placeholder="Sexe / genre du personnage">
                            </div>
                        </div>

                        <div class="field-group field-group--inline">
                            <div class="field-group">
                                <label class="field-label" for="identiteRace">Race</label>
                                <input id="identiteRace" class="field-input" type="text" placeholder="Race ou esp√®ce (humaine, hybride, etc.)">
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="identiteHierarchieSociale">Hi√©rarchie sociale</label>
                                <input id="identiteHierarchieSociale" class="field-input" type="text" placeholder="Noble, roturier, famille influente, etc.">
                            </div>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="identitePaysOrigine">Pays d‚Äôorigine</label>
                            <input id="identitePaysOrigine" class="field-input" type="text" placeholder="Royaume / pays / r√©gion d‚Äôorigine.">
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="identite">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Appartenance -->
                    <section id="tab-appartenance" class="tab-panel" aria-label="Appartenance">
                        <h2 class="section-title">Appartenance</h2>

                        <div class="field-group">
                            <label class="field-label" for="appRangEtoile">Rang √©toil√©</label>
                            <select id="appRangEtoile" class="field-input">
                                <option value="">S√©lectionner...</option>
                                <option value="sans-etoile">‚îÉ‚îú‚å©‚≠ê„Äã‚ù±‚Üí Sans √©toile</option>
                                <option value="simple">‚îÉ‚îú‚å©‚≠ê„Äã‚ù±‚Üí Simple</option>
                                <option value="double">‚îÉ‚îú‚å©‚≠ê„Äã‚ù±‚Üí Double</option>
                                <option value="triple">‚îÉ‚îú‚å©‚≠ê„Äã‚ù±‚Üí Triple</option>
                                <option value="major">‚îÉ‚îú‚å©üåü„Äã‚ù±‚Üí Major</option>
                            </select>
                        </div>

                        <div class="field-group field-group--inline">
                            <div class="field-group">
                                <label class="field-label" for="appRole">R√¥le</label>
                                <select id="appRole" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="eleve">√âl√®ve</option>
                                    <option value="adulte">Adulte</option>
                                </select>
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="appNiveauScolaire">Niveau scolaire</label>
                                <select id="appNiveauScolaire" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="maternelle">Maternelle</option>
                                    <option value="college">Coll√®ge</option>
                                    <option value="lycee">Lyc√©e</option>
                                    <option value="universite">Universit√©</option>
                                </select>
                            </div>
                        </div>

                        <div class="field-group field-group--inline">
                            <div class="field-group">
                                <label class="field-label" for="appAffection">Affection</label>
                                <select id="appAffection" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="civil">Civil</option>
                                    <option value="sorcier">Sorcier</option>
                                    <option value="eater">Eater</option>
                                    <option value="alice">Alice</option>
                                </select>
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="appHouse">House</label>
                                <select id="appHouse" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="red-spider">‚îÉ‚îú‚å©üï∑Ô∏è„Äã‚ù±‚Üí Red Spider House</option>
                                    <option value="blue-bear">‚îÉ‚îú‚å©üêª„Äã‚ù±‚Üí Blue Bear House</option>
                                    <option value="violet-goat">‚îÉ‚îú‚å©üêê„Äã‚ù±‚Üí Violet Goat House</option>
                                    <option value="green-turtle">‚îÉ‚îú‚å©üê¢„Äã‚ù±‚Üí Green Turtle House</option>
                                </select>
                            </div>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="appHierarchie">Hi√©rarchie</label>
                            <input
                                id="appHierarchie"
                                class="field-input"
                                type="text"
                                placeholder="Intendant, pr√©fet, √©tudiant, membre du staff, etc."
                            >
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="appartenance">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Combat -->
                    <section id="tab-combat" class="tab-panel" aria-label="Combat">
                        <h2 class="section-title">Combat</h2>

                        <div class="field-group">
                            <label class="field-label" for="combatStyle">Style de combat</label>
                            <textarea
                                id="combatStyle"
                                class="field-input field-textarea"
                                rows="5"
                                placeholder="D√©crivez le style de combat global : posture, philosophie, forces et faiblesses."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="combatTechniques">Techniques actuelles</label>
                            <textarea
                                id="combatTechniques"
                                class="field-input field-textarea"
                                rows="5"
                                placeholder="Maximum 3 techniques, sans magie (attaques physiques, parades, styles martiaux...)."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="combatArme">Type d‚Äôarme</label>
                            <input
                                id="combatArme"
                                class="field-input"
                                type="text"
                                placeholder="Type d‚Äôarme principale : √©p√©e, faux, arme improvis√©e, etc."
                            >
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="combatArmeImage">Image de l‚Äôarme (URL)</label>
                            <input
                                id="combatArmeImage"
                                class="field-input"
                                type="url"
                                placeholder="Lien vers une illustration de l‚Äôarme (optionnel)."
                            >
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="combat">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Alice -->
                    <section id="tab-alice" class="tab-panel" aria-label="Alice">
                        <h2 class="section-title">Alice</h2>

                        <div class="field-group">
                            <label class="field-label">
                                <input id="hasAlice" type="checkbox">
                                Poss√®de une Alice
                            </label>
                        </div>

                        <div id="alice-fields" class="conditional-block" hidden>
                            <div class="field-group">
                                <label class="field-label" for="aliceNom">Nom de l‚ÄôAlice</label>
                                <input id="aliceNom" class="field-input" type="text" placeholder="Nom ou titre de l‚ÄôAlice.">
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="aliceType">Type</label>
                                <input
                                    id="aliceType"
                                    class="field-input"
                                    type="text"
                                    placeholder="Type d‚ÄôAlice : physiologique, mentale, √©l√©mentaire, etc."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="aliceForme">Forme</label>
                                <input
                                    id="aliceForme"
                                    class="field-input"
                                    type="text"
                                    placeholder="Forme(s) ou modalit√©s d‚Äôexpression de l‚ÄôAlice."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="aliceFiche">Fiche compl√®te (URL)</label>
                                <input
                                    id="aliceFiche"
                                    class="field-input"
                                    type="url"
                                    placeholder="Lien vers la fiche d√©taill√©e de l‚ÄôAlice (si s√©par√©e)."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label">Poss√®de un Double Alice</label>
                                <div class="field-group field-group--inline">
                                    <div class="field-group">
                                        <label class="field-label" for="doubleAliceNom">Nom de l'Alice</label>
                                        <input id="doubleAliceNom" class="field-input" type="text" placeholder="Nom ou titre du Double Alice.">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label" for="doubleAliceType">Type</label>
                                        <input id="doubleAliceType" class="field-input" type="text" placeholder="Type du Double Alice.">
                                    </div>
                                </div>
                                <div class="field-group field-group--inline">
                                    <div class="field-group">
                                        <label class="field-label" for="doubleAliceForme">Forme</label>
                                        <input id="doubleAliceForme" class="field-input" type="text" placeholder="Forme ou expression du Double Alice.">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label" for="doubleAliceFiche">Fiche compl√®te (URL)</label>
                                        <input id="doubleAliceFiche" class="field-input" type="url" placeholder="Lien vers la fiche compl√®te du Double Alice.">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="alice">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Sorcellerie -->
                    <section id="tab-sorcellerie" class="tab-panel" aria-label="Sorcellerie">
                        <h2 class="section-title">Sorcellerie</h2>

                        <div class="field-group">
                            <label class="field-label">
                                <input id="hasMagic" type="checkbox">
                                Poss√®de de la magie
                            </label>
                        </div>

                        <div id="sorcellerie-fields" class="conditional-block" hidden>
                            <div class="field-group">
                                <label class="field-label" for="sorcelleriePrincipale">Magie principale</label>
                                <input
                                    id="sorcelleriePrincipale"
                                    class="field-input"
                                    type="text"
                                    placeholder="Sp√©cialisation principale (ex : feu, soin, gravit√©...)."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="sorcellerieSecondaire">Magie secondaire</label>
                                <input
                                    id="sorcellerieSecondaire"
                                    class="field-input"
                                    type="text"
                                    placeholder="Magie secondaire √©ventuelle (optionnelle)."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="sorcellerieCachee">Magie cach√©e</label>
                                <input
                                    id="sorcellerieCachee"
                                    class="field-input"
                                    type="text"
                                    placeholder="Magie cach√©e ou en latence (si connue de l‚Äô√©quipe)."
                                >
                            </div>

                            <div class="field-group">
                                <button type="button" class="btn-secondary" id="addMagieCachee" aria-label="Ajouter une magie cach√©e">+</button>
                            </div>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="sorcellerie">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Eater -->
                    <section id="tab-eater" class="tab-panel" aria-label="Eater">
                        <h2 class="section-title">Eater</h2>

                        <div class="field-group">
                            <label class="field-label">
                                <input id="hasEater" type="checkbox">
                                Poss√®de une capacit√© d‚Äô√¢me
                            </label>
                        </div>

                        <div id="eater-fields" class="conditional-block" hidden>
                            <div class="field-group">
                                <label class="field-label">Compteur d'√¢mes</label>
                                <div class="field-group field-group--inline">
                                    <div class="field-group">
                                        <label class="field-label" for="eaterAmesConsommation">√Çmes de Consommation</label>
                                        <input id="eaterAmesConsommation" class="field-input" type="number" min="0" value="0">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label" for="eaterAmesProgression">√Çmes de Progression</label>
                                        <input id="eaterAmesProgression" class="field-input" type="number" min="0" value="0">
                                    </div>
                                </div>
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterRole">R√¥le</label>
                                <select id="eaterRole" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="meister">Meister</option>
                                    <option value="weapon">Weapon</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterTypeArme">Type d‚Äôarme</label>
                                <select id="eaterTypeArme" class="field-input">
                                    <option value="">S√©lectionner...</option>
                                    <option value="classique">Classique</option>
                                    <option value="multi-formes">Multi-formes</option>
                                    <option value="jumelees">Jumel√©es</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterDescriptionArme">Description de l‚Äôarme</label>
                                <textarea
                                    id="eaterDescriptionArme"
                                    class="field-input field-textarea"
                                    rows="4"
                                    placeholder="Description d√©taill√©e de l‚Äôarme, de ses formes et particularit√©s."
                                ></textarea>
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterImageArme">Image de l‚Äôarme (URL)</label>
                                <input
                                    id="eaterImageArme"
                                    class="field-input"
                                    type="url"
                                    placeholder="Lien vers une illustration de l‚Äôarme (optionnel)."
                                >
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterNoyau">Capacit√© unique [Noyau]</label>
                                <textarea
                                    id="eaterNoyau"
                                    class="field-input field-textarea"
                                    rows="4"
                                    placeholder="Capacit√© centrale li√©e au noyau de l‚Äô√¢me."
                                ></textarea>
                            </div>

                            <div class="field-group">
                                <label class="field-label" for="eaterFragments">Capacit√© unique [Fragments]</label>
                                <textarea
                                    id="eaterFragments"
                                    class="field-input field-textarea"
                                    rows="4"
                                    placeholder="√Ä remplir seulement si acquis (fragment(s) li√©s au noyau)."
                                ></textarea>
                            </div>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="eater">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Religion -->
                    <section id="tab-religion" class="tab-panel" aria-label="Religion">
                        <h2 class="section-title">Religion</h2>

                        <div class="field-group">
                            <label class="field-label" for="religionCroyance">Croyance</label>
                            <textarea
                                id="religionCroyance"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="Religion, panth√©on ou croyance principale du personnage."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="religionProphetie">Proph√©tie</label>
                            <textarea
                                id="religionProphetie"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="Proph√©tie, pr√©sage ou destin√©e annonc√©e (le cas √©ch√©ant)."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="religionBenediction">B√©n√©diction</label>
                            <textarea
                                id="religionBenediction"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="B√©n√©dictions divines, protections, dons particuliers."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="religionMalediction">Mal√©diction</label>
                            <textarea
                                id="religionMalediction"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="Mal√©dictions, pactes, contreparties, stigmates."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="religion">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Mental -->
                    <section id="tab-mental" class="tab-panel" aria-label="Mental">
                        <h2 class="section-title">Mental</h2>

                        <div class="field-group">
                            <label class="field-label" for="mentalCaractere">Caract√®re</label>
                            <textarea
                                id="mentalCaractere"
                                class="field-input field-textarea"
                                rows="5"
                                placeholder="5 lignes minimum : temp√©rament, r√©actions, qualit√©s, d√©fauts, √©volution possible."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="mentalButsReves">But(s) &amp; r√™ve(s)</label>
                            <textarea
                                id="mentalButsReves"
                                class="field-input field-textarea"
                                rows="4"
                                placeholder="Au moins un but et un r√™ve obligatoires (objectifs de vie, aspirations profondes)."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="mentalAutre">Autre</label>
                            <textarea
                                id="mentalAutre"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="Particularit√©s du comportement, phobies, TOC, habitudes, etc."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="mental">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Physique -->
                    <section id="tab-physique" class="tab-panel" aria-label="Physique">
                        <h2 class="section-title">Physique</h2>

                        <div class="field-group">
                            <label class="field-label" for="physiqueDescription">Description physique</label>
                            <textarea
                                id="physiqueDescription"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="3 lignes minimum : allure, tenues, d√©tails marquants (cicatrices, bijoux, etc.)."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="physiqueSante">Sant√©</label>
                            <textarea
                                id="physiqueSante"
                                class="field-input field-textarea"
                                rows="3"
                                placeholder="Pr√©cisez les √©ventuels probl√®mes de sant√©, limitations ou particularit√©s."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="physique">Enregistrer</button>
                        </div>
                    </section>

                    <!-- Background -->
                    <section id="tab-background" class="tab-panel" aria-label="Background">
                        <h2 class="section-title">Background</h2>

                        <div class="field-group">
                            <label class="field-label" for="backgroundFamille">Parents / famille</label>
                            <textarea
                                id="backgroundFamille"
                                class="field-input field-textarea"
                                rows="4"
                                placeholder="Famille proche, liens importants, √©ventuels liens nobles ou religieux."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="backgroundHistoire">Histoire</label>
                            <textarea
                                id="backgroundHistoire"
                                class="field-input field-textarea"
                                rows="10"
                                placeholder="Minimum ~2000 caract√®res (avec espaces). Racontez le parcours complet du personnage, les √©v√©nements marquants, sa place dans le monde."
                            ></textarea>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="backgroundImage1">Image 1 (URL)</label>
                            <input
                                id="backgroundImage1"
                                class="field-input"
                                type="url"
                                placeholder="Lien vers une r√©f√©rence visuelle du personnage."
                            >
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="backgroundImage2">Image 2 (URL)</label>
                            <input
                                id="backgroundImage2"
                                class="field-input"
                                type="url"
                                placeholder="Deuxi√®me lien d‚Äôimage (optionnel)."
                            >
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="backgroundImage3">Image 3 (URL)</label>
                            <input
                                id="backgroundImage3"
                                class="field-input"
                                type="url"
                                placeholder="Troisi√®me lien d‚Äôimage (optionnel)."
                            >
                        </div>

                        <div class="field-group">
                            <button type="button" class="btn-primary tab-save-button" data-tab-target="background">Enregistrer</button>
                        </div>
                    </section>
                </form>
            </section>
        </section>
    </main>

    <script>
        (function () {
            const tabButtons = Array.from(document.querySelectorAll('.tab-button'));
            const tabPanels = Array.from(document.querySelectorAll('.tab-panel'));

            tabButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    const target = button.dataset.tab;
                    if (!target) return;

                    tabButtons.forEach((btn) => btn.classList.remove('active'));
                    button.classList.add('active');

                    tabPanels.forEach((panel) => {
                        const isActive = panel.id === 'tab-' + target;
                        panel.classList.toggle('active', isActive);
                        panel.hidden = !isActive;
                    });
                });
            });

            const conditionalConfigs = [
                { checkboxId: 'hasAlice', panelId: 'alice-fields' },
                { checkboxId: 'hasMagic', panelId: 'sorcellerie-fields' },
                { checkboxId: 'hasEater', panelId: 'eater-fields' }
            ];

            conditionalConfigs.forEach(({ checkboxId, panelId }) => {
                const checkbox = document.getElementById(checkboxId);
                const panel = document.getElementById(panelId);
                if (!checkbox || !panel) return;

                const updateVisibility = () => {
                    panel.hidden = !checkbox.checked;
                };

                checkbox.addEventListener('change', updateVisibility);
                updateVisibility();
            });

            const saveTabData = (tabId) => {
                const panel = document.getElementById(tabId);
                if (!panel) return;

                const inputs = panel.querySelectorAll('input, select, textarea');
                const data = {};

                inputs.forEach((input) => {
                    if (!input.id) return;
                    if (input.type === 'checkbox') {
                        data[input.id] = input.checked;
                    } else if (input.type === 'radio') {
                        if (input.checked) data[input.name || input.id] = input.value;
                    } else {
                        data[input.id] = input.value;
                    }
                });

                console.log(`Enregistrement du contenu de ${tabId}:`, data);
            };

            document.querySelectorAll('.tab-save-button').forEach((button) => {
                button.addEventListener('click', () => {
                    const target = button.dataset.tabTarget;
                    if (!target) return;
                    saveTabData(`tab-${target}`);
                });
            });

            const addMagieCacheeButton = document.getElementById('addMagieCachee');
            const baseMagieCacheeInput = document.getElementById('sorcellerieCachee');
            if (addMagieCacheeButton && baseMagieCacheeInput) {
                const baseGroup = baseMagieCacheeInput.closest('.field-group');
                const container = baseGroup?.parentElement;
                let magieCacheeCount = 1;

                addMagieCacheeButton.addEventListener('click', () => {
                    if (!baseGroup || !container) return;

                    magieCacheeCount += 1;
                    const clone = baseGroup.cloneNode(true);
                    const clonedInput = clone.querySelector('input');
                    const clonedLabel = clone.querySelector('label');

                    if (clonedInput) {
                        const newId = `sorcellerieCachee${magieCacheeCount}`;
                        clonedInput.id = newId;
                        clonedInput.value = '';
                        clonedInput.placeholder = baseMagieCacheeInput.placeholder;
                        clonedInput.setAttribute('aria-label', `${clonedLabel?.textContent?.trim() || 'Magie cach√©e'} ${magieCacheeCount}`);
                    }

                    if (clonedLabel && clonedInput) {
                        clonedLabel.setAttribute('for', clonedInput.id);
                    }

                    container.insertBefore(clone, addMagieCacheeButton.parentElement);
                });
            }
        })();
    </script>
</body>
</html>
